# Руководство по системе дедлайнов

## Обзор

Система дедлайнов позволяет устанавливать временные рамки при назначении задач сотрудникам и контролировать отклонения от плана. Дедлайны устанавливаются на уровне назначений задач, что обеспечивает гибкость и точность планирования.

## Типы дедлайнов

### 1. Мягкие дедлайны (Soft)
- **Описание**: Можно превышать плановые часы в любое время
- **Использование**: Для личных задач сотрудников, исследовательских задач
- **Валидация**: Отклонения от плана всегда разрешены

### 2. Жесткие дедлайны (Hard)
- **Описание**: Превышение плановых часов возможно только после дедлайна
- **Использование**: Для критичных задач, назначенных администратором
- **Валидация**: Отклонения от плана разрешены только после дедлайна

## Приоритеты задач

- **Низкий (Low)**: 1.5x от расчетного времени
- **Средний (Medium)**: 1.0x от расчетного времени (по умолчанию)
- **Высокий (High)**: 0.7x от расчетного времени
- **Срочный (Urgent)**: 0.5x от расчетного времени

## Логика установки дедлайнов

### При назначении задач сотрудникам:
1. **Администратор/Руководитель**: Устанавливает дедлайны при распределении задач в календарь
2. **Система**: Предлагает автоматические дедлайны на основе сложности и приоритета
3. **Гибкость**: Каждое назначение может иметь свой дедлайн и приоритет

### Для задач в календаре:
1. **Личные задачи**: Мягкие дедлайны (можно превышать)
2. **Назначенные задачи**: Жесткие дедлайны (отклонения только после дедлайна)

## Валидация отклонений

### Условия для критичного отклонения:
1. ✅ Прошел дедлайн назначения задачи
2. ✅ Тип дедлайна = 'hard'
3. ✅ Превышение составляет более 10% от планового времени

### Когда отклонения разрешены:
- Мягкие дедлайны (deadlineType = 'soft')
- После прохождения жесткого дедлайна
- Задачи без дедлайна

## Уведомления

Система показывает уведомления для:
- **Просроченных задач**: Красный индикатор, количество дней просрочки
- **Приближающихся дедлайнов**: Желтый индикатор, количество дней до дедлайна (≤3 дней)

## Автоматический расчет дедлайнов

Система автоматически рассчитывает рекомендуемые дедлайны на основе:
- Плановых часов задачи
- Приоритета задачи
- Рабочих дней в неделе (по умолчанию 5)
- Часов в день (по умолчанию 8)
- Буферного времени (20% от расчетного)

## Примеры использования

### Сценарий 1: Сотрудник создает личную задачу
```
- Тип дедлайна: Мягкий
- Назначена админом: false
- Результат: Отклонения от плана всегда разрешены
```

### Сценарий 2: Администратор назначает критичную задачу
```
- Тип дедлайна: Жесткий
- Назначена админом: true
- Дедлайн: 2024-01-15
- Результат: Отклонения разрешены только после 15 января
```

### Сценарий 3: Задача с мягким дедлайном
```
- Тип дедлайна: Мягкий
- Назначена админом: true
- Результат: Отклонения от плана всегда разрешены
```

## Настройка полей в базе данных

### Таблица task_assignments:
- `deadline` (date) - дата дедлайна для этого назначения
- `deadline_type` (text) - 'soft' или 'hard'
- `deadline_reason` (text) - обоснование дедлайна
- `priority` (text) - приоритет: 'low', 'medium', 'high', 'urgent'

### Таблица time_slots:
- `deadline` (date) - дата дедлайна
- `deadline_type` (text) - 'soft' или 'hard'
- `is_assigned_by_admin` (boolean) - назначена ли администратором
- `deadline_reason` (text) - обоснование дедлайна

## Миграция базы данных

Выполните миграцию `20250127000000_add_deadlines.sql` для добавления полей дедлайнов в существующие таблицы.

## API изменения

Все функции создания и обновления задач/временных слотов теперь поддерживают поля дедлайнов:

```typescript
// Создание назначения задачи с дедлайном
const assignment = {
  taskId: 'task-123',
  employeeId: 'employee-456',
  allocatedHours: 40,
  deadline: '2024-01-15',
  deadlineType: 'hard',
  deadlineReason: 'Критично для релиза',
  priority: 'high'
};
```

## Лучшие практики

1. **Устанавливайте дедлайны для всех задач** - это повышает ответственность и планирование
2. **Используйте жесткие дедлайны для критичных задач** - это предотвращает превышения до дедлайна
3. **Обосновывайте дедлайны** - это помогает команде понимать приоритеты
4. **Регулярно проверяйте уведомления** - это предотвращает просрочки
5. **Корректируйте дедлайны при необходимости** - система должна быть гибкой
